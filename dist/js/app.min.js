function Application(){}function Ball(){}function Block(){}function Canvas(){}function CanvasElement(){}function ComputerPaddleControls(){}function init(){var t=(getNodeById("overlay"),new Application);t.init(),overlay.style.visibility="hidden"}function Paddle(){}function PaddleControls(){}function PlayerPaddleControls(){}function Referee(){}function Scoreboard(){}function getcomputedStyleAttr(t,e){var o=getNodeById(t);return getComputedStyle(o)[e]}function getNodeById(t){return document.getElementById(t)}function range(t,e,o){var i=[];if("undefined"==typeof o&&(o=1),t&&e&&o)for(;e>=t;)i.push(t),t+=o;return i}function radToDeg(t){return"number"!=typeof t?0:57.29577951308232*t}function sign(t){return"number"!=typeof t?1:t>=0?1:-1}Application.prototype.init=function(){this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.pause=!1,this.leftColor=getcomputedStyleAttr("paddleLeft","color"),this.rightColor=getcomputedStyleAttr("paddleRight","color"),this.scoreboard=new Scoreboard,this.referee=new Referee,this.playerPaddleControls=new PlayerPaddleControls,this.computerPaddleControls=new ComputerPaddleControls,this.canvas=new Canvas,this.canvas.init({canvasId:"canvas",physicsCanvasId:"physics",renderPhysics:!1,bounds:{top:this.scoreboard.HEIGHT,bottom:this.windowHeight,left:0,right:this.windowWidth}}),this.scoreboard.init({scoreLeftId:"scoreLeft",scoreRightId:"scoreRight"}),this.referee.init(),this.pubSubTokens=[["gameover",PubSub.subscribe("gameOver",this.reset.bind(this))]],this.initPaddlesBalls(),this.initBlocks(),window.requestAnimationFrame(this.update.bind(this)),window.addEventListener("resize",this.reset.bind(this)),window.addEventListener("keyup",this.keyUpHandler.bind(this))},Application.prototype.initPaddlesBalls=function(){var t=null,e=null;e=this.canvas.addPaddle({name:"paddleLeft",x:5,y:this.windowHeight/2-Paddle.prototype.HEIGHT/2,color:this.leftColor}),this.canvas.addBall({name:"ballLeft",x:5+Paddle.prototype.WIDTH,y:this.windowHeight/2-Ball.prototype.HEIGHT/2,color:this.leftColor}),t=this.canvas.addPaddle({name:"paddleRight",x:this.windowWidth-5-Paddle.prototype.WIDTH,y:this.windowHeight/2-Paddle.prototype.HEIGHT/2,color:this.rightColor}),this.canvas.addBall({name:"ballRight",x:this.windowWidth-5-Paddle.prototype.WIDTH-Ball.prototype.WIDTH,y:this.windowHeight/2-Ball.prototype.HEIGHT/2,color:this.rightColor}),this.playerPaddleControls.init({paddle:t}),this.computerPaddleControls.init({paddle:e})},Application.prototype.initBlocks=function(){var t=2,e=.15,o={left:this.windowWidth/2-this.windowWidth*e,right:this.windowWidth/2+this.windowWidth*e,top:this.canvas.bounds.top+t,bottom:this.canvas.bounds.bottom-t},i=[],s=[];Block.prototype.HEIGHT=Block.prototype.WIDTH=(o.bottom-o.top)/10,i=range(o.top,o.bottom,Block.prototype.HEIGHT+t),s=range(o.left,o.right,Block.prototype.WIDTH+t),fjs.each(function(t,e){fjs.each(function(o,i){var s=Math.random()>.6,a=null,n=null;s?(result=Math.random()>.5?{color:this.leftColor,prizeFor:"paddleLeft"}:{color:this.rightColor,prizeFor:"paddleRight"},a=result.prizeFor,n=result.color):(n=Block.prototype.COLOR,a=null),this.canvas.addBlock({name:"block"+e+"_"+i,x:o,y:t,color:n,prizeFor:a})}.bind(this),s)}.bind(this),i)},Application.prototype.update=function(){var t=null;return this.pause?void(this.requestAnimationFrameId=window.requestAnimationFrame(this.update.bind(this))):(this.now=Date.now(),this.then||(this.then=this.now),t=(this.now-this.then)/1e3,this.canvas.update(t)===!0?this.requestAnimationFrameId=window.requestAnimationFrame(this.update.bind(this)):window.cancelAnimationFrame(this.requestAnimationFrameId),void(this.then=this.now))},Application.prototype.reset=function(){this.canvas.reset(),this.scoreboard.reset(),this.referee.reset(),this.playerPaddleControls.reset(),this.computerPaddleControls.reset(),PubSub.clearAllSubscriptions(),window.removeEventListener("resize",this.reset),fjs.each(function(t){PubSub.unsubscribe(t[1])}.bind(this),this.pubSubTokens),this.init()},Application.prototype.keyUpHandler=function(t){80===t.which&&this.togglePause()},Application.prototype.togglePause=function(){this.pause=!this.pause},Ball.prototype=Object.create(CanvasElement.prototype),Ball.prototype.constructor=Ball,Ball.prototype.WIDTH=function(){var t=getcomputedStyleAttr("ballLeft","width");return parseInt(t.replace("px",""),10)}(),Ball.prototype.HEIGHT=function(){var t=getcomputedStyleAttr("ballLeft","height");return parseInt(t.replace("px",""),10)}(),Block.prototype=Object.create(CanvasElement.prototype),Block.prototype.constructor=Block,Block.prototype.WIDTH=function(){var t=getcomputedStyleAttr("blockBase","width");return parseInt(t.replace("px",""),10)}(),Block.prototype.HEIGHT=function(){var t=getcomputedStyleAttr("blockBase","height");return parseInt(t.replace("px",""),10)}(),Block.prototype.COLOR=function(){return getcomputedStyleAttr("blockBase","color")}(),Block.prototype.init=function(t){CanvasElement.prototype.init.call(this,t),this.prizeFor=t.prizeFor||null,this.deleted=!1},Block.prototype.isPrize=function(){return null!==this.prizeFor},Block.prototype.isPrizeForRight=function(){return this.isPrizeFor("right")},Block.prototype.isPrizeForLeft=function(){return this.isPrizeFor("left")},Block.prototype.isPrizeFor=function(t){return this.isPrize()?this.prizeFor.toLowerCase().indexOf(t.toLowerCase())>-1:!1},Canvas.prototype.init=function(t){this.initParams=t,this.bounds=t.bounds,this.canvasId=t.canvasId,this.physicsCanvasId=t.physicsCanvasId,this.renderPhysics=t.renderPhysics,this.canvasNode=getNodeById(this.canvasId),this.canvasNode.width=window.innerWidth,this.canvasNode.height=window.innerHeight,this.paddles=[],this.balls=[],this.blocks=[],this.prizes=[],this.delta=0,this.stage=new createjs.Stage(this.canvasId),this.ballVelX=this.ballVelY=1,this.initPhysics(),this.pubSubTokens=[],this.pubSubTokens.push(["updatePaddle",PubSub.subscribe("updatePaddle",this.updatePaddleFromMessage.bind(this))],["updateBlock",PubSub.subscribe("updateBlock",this.updateBlockFromMessage.bind(this))],["shakeCanvas",PubSub.subscribe("shakeCanvas",this.shakeCanvasAsync.bind(this))]),this.ready=!0},Canvas.prototype.initPhysics=function(){var t=null,e=null;this.world=Physics(),this.renderPhysics?(t=Physics.renderer("canvas",{el:this.physicsCanvasId,width:this.canvasNode.width,height:this.canvasNode.height}),this.world.add(t)):(e=getNodeById(this.physicsCanvasId),e&&e.parentNode.removeChild(e)),this.world.add(Physics.behavior("constant-acceleration")),this.world.add(Physics.behavior("body-impulse-response")),this.world.add(Physics.behavior("body-collision-detection")),this.world.add(Physics.behavior("sweep-prune")),this.worldBoundingBox=Physics.aabb(this.bounds.left,this.bounds.top,this.bounds.right,this.bounds.bottom),this.worldBoundingBox=Physics.behavior("edge-collision-detection",{aabb:this.worldBoundingBox,restitution:.5,cof:0}),this.worldBoundingBox.body.canvasElementType="aabb",this.world.add(this.worldBoundingBox),this.world.on("collisions:detected",this.bodyCollisions.bind(this))},Canvas.prototype.update=function(t){return this.ready===!1?!1:(this.delta=t,this.updateToPhysics(),this.world.step(Date.now()),this.updateFromPhysics(),this.renderPhysics&&this.world.render(),this.stage.update(),!0)},Canvas.prototype.reset=function(){this.ready=!1,this.paddles=[],this.balls=[],this.blocks=[],this.prizes=[],this.stage.removeAllChildren(),this.stage.removeAllEventListeners(),this.stage=void 0,fjs.each(function(t){PubSub.unsubscribe(t[1])}.bind(this),this.pubSubTokens),this.world.destroy(),this.world=void 0},Canvas.prototype.addPaddle=function(t){var e=this.addCanvasElement(Paddle,t);return this.addStageRect(e),this.addPhysics(e,e.constructor.name,"rectangle",{x:e.x+e.WIDTH/2,y:e.y+e.HEIGHT/2,width:e.WIDTH,height:e.HEIGHT,treatment:"static",restitution:1,cof:0}),e},Canvas.prototype.addBlock=function(t){var e=this.addCanvasElement(Block,t);this.addStageRect(e),this.addPhysics(e,e.constructor.name,"rectangle",{x:e.x+e.WIDTH/2,y:e.y+e.HEIGHT/2,width:e.WIDTH,height:e.HEIGHT,mass:10,vy:1,restitution:1,cof:1})},Canvas.prototype.addBall=function(t){var e=this.addCanvasElement(Ball,t);this.addStageCirc(e),this.addPhysics(e,e.constructor.name,"circle",{x:e.x+e.WIDTH/2,y:e.y+e.HEIGHT/2,vx:-1!=t.name.toLowerCase().indexOf("right")?-2:2,vy:.5,radius:e.WIDTH/2,mass:5,restitution:1,cof:1})},Canvas.prototype.addCanvasElement=function(t,e){var o=this.getArrayKeyByType(t),i=null;return i=new t,i.init(e),this[o].push(i),i},Canvas.prototype.addPhysics=function(t,e,o,i){var s=Physics.body(o,i);return s&&(s.canvasElementType=e,s.canvasElement=t,t.physics=s,this.world.add(s)),s},Canvas.prototype.addStageRect=function(t){return this.addStageShape(t,"drawRect")},Canvas.prototype.addStageCirc=function(t){return this.addStageShape(t,"drawEllipse")},Canvas.prototype.addStageShape=function(t,e){var o,i=null;return o=new createjs.Shape,o.graphics.beginFill(t.color)[e](0,0,t.WIDTH,t.HEIGHT),o.x=t.x,o.y=t.y,o.regX=t.WIDTH/2,o.regY=t.HEIGHT/2,i=this.stage.addChild(o),i.canvasElement=t,t.view=i,t.id=i.id,o},Canvas.prototype.updatePaddleFromMessage=function(t,e){this.updatePaddle(e.name,e)},Canvas.prototype.updateBlockFromMessage=function(t,e){this.updateBlock(e.name,e)},Canvas.prototype.updatePaddle=function(t,e){this.updateType(t,e,Paddle)},Canvas.prototype.updateBall=function(t,e){this.updateType(t,e,Ball)},Canvas.prototype.updateBlock=function(t,e){this.updateType(t,e,Block)},Canvas.prototype.updateType=function(t,e,o){var i=this.findByNameType(t,o),s=o.name.toLowerCase();i&&(e.x&&(i.x=e.x,i.view.x=e.x),e.y&&(i.y=e.y,i.view.y=e.y),e.rotRad&&(i.rotRad=e.rotRad,i.view.rotation=radToDeg(e.rotRad)),e.color&&i.changeColor(e.color),e={},e[s]=i,PubSub.publish(s+"Updated",e))},Canvas.prototype.removeByNameType=function(t,e){var o=this.findByNameType(t,e),i=this.getArrayKeyByType(e);o&&this[i]&&(this[i]=fjs.select("x => x.name !== '"+t+"'",this[i]),"blocks"==i&&this[i].length<=0&&PubSub.publish("noMoreBlocks",{}))},Canvas.prototype.findByNameType=function(t,e){var o=this.getArrayKeyByType(e);return fjs.first("x => x.name === '"+t+"'",this[o])},Canvas.prototype.getArrayKeyByType=function(t){return t?t.name.toLowerCase()+"s":""},Canvas.prototype.updateToPhysics=function(){this.world&&fjs.each(function(t){var e=null;"Ball"===t.canvasElementType?(e=t.state.vel,t.state.vel=Physics.vector(e.x+sign(e.x)*this.ballVelX*this.delta,e.y+sign(e.y)*this.ballVelY*this.delta)):"Paddle"===t.canvasElementType&&(t.state.pos=Physics.vector(t.canvasElement.x,t.canvasElement.y),t.state.angular.pos=t.canvasElement.rotRad)}.bind(this),this.world.getBodies())},Canvas.prototype.updateFromPhysics=function(){var t=null;this.world&&fjs.each(function(e){t={x:e.state.pos.x,y:e.state.pos.y,rotRad:e.state.angular.pos},"Ball"===e.canvasElementType?this.updateBall(e.canvasElement.name,t):"Block"===e.canvasElementType&&this.updateBlock(e.canvasElement.name,t)}.bind(this),this.world.getBodies())},Canvas.prototype.bodyCollisions=function(t){function e(t,e,o){return fjs.first("x => x.canvasElementType === '"+o+"'",[t,e])}var o=t.collisions;fjs.each(function(t){function o(){this.ready&&(this.stage.removeChild(n.canvasElement.view),this.world.remove(n),n.canvasElement.deleted=!0,this.removeByNameType(n.canvasElement.name,Block))}var i=t.bodyA,s=t.bodyB,a=fjs.curry(e)(i,s),n=a("Block"),r=a("Ball"),d=a("Paddle"),l=a("aabb");n&&r&&(PubSub.publish("blockBallHit",{ball:r.canvasElement,block:n.canvasElement}),window.setTimeout(o.bind(this),200)),r&&d&&(PubSub.publish("ballPaddleHit",{ball:r.canvasElement,paddle:d.canvasElement}),this.ballVelX=this.ballVelY+=1e-4),r&&l&&PubSub.publish("boundingBoxBallHit",{ball:r.canvasElement,boundingBox:l})}.bind(this),o)},Canvas.prototype.shakeCanvasAsync=function(){window.setTimeout(this.shakeCanvas.bind(this),0)},Canvas.prototype.shakeCanvas=function(){this.shakeCanvasSteps||(this.shakeCanvasSteps=0),this.shakeCanvasSteps<=20?(this.shakeCanvasSteps%2===0?(this.canvasNode.style.position="absolute",this.canvasNode.style.top="-5px"):(this.canvasNode.style.position="absolute",this.canvasNode.style.top="10px"),this.shakeCanvasSteps+=1,window.setTimeout(this.shakeCanvas.bind(this),10)):(this.shakeCanvasSteps=0,this.canvasNode.style.position="absolute",this.canvasNode.style.top="0px")},CanvasElement.prototype.init=function(t){this.initParams=t,this.id=t.id,this.name=t.name,this.x=t.x,this.y=t.y,this.color=t.color,this.rotRad=t.rotRad||0,this.view=null,this.physics=null},CanvasElement.prototype.changeColor=function(t){this.view&&t&&(this.view.graphics._fill.style=t)},CanvasElement.prototype.isRight=function(){return this.isSide("right")},CanvasElement.prototype.isLeft=function(){return this.isSide("left")},CanvasElement.prototype.isSide=function(t){return this.name&&t?this.name.toLowerCase().indexOf(t.toLowerCase())>-1:!1},ComputerPaddleControls.prototype=Object.create(PaddleControls.prototype),ComputerPaddleControls.prototype.constructor=ComputerPaddleControls,ComputerPaddleControls.prototype.init=function(t){this.pubSubTokens=[],PaddleControls.prototype.init.call(this,t)},ComputerPaddleControls.prototype.movePaddle=function(t,e){var o=null;e&&(o=e.ball,o&&"ballRight"===o.name&&PubSub.publish("updatePaddle",{name:this.paddle.name,y:o.y-o.HEIGHT/2}))},ComputerPaddleControls.prototype.enable=function(){this.pubSubTokens&&this.pubSubTokens.push(["ballUpdated",PubSub.subscribe("ballUpdated",this.movePaddle.bind(this))])},ComputerPaddleControls.prototype.disable=function(){this.pubSubTokens&&fjs.each(function(t){PubSub.unsubscribe(t[1])}.bind(this),this.pubSubTokens)},Paddle.prototype=Object.create(CanvasElement.prototype),Paddle.prototype.constructor=Paddle,Paddle.prototype.WIDTH=function(){var t=getcomputedStyleAttr("paddleLeft","width");return parseInt(t.replace("px",""),10)}(),Paddle.prototype.HEIGHT=function(){var t=getcomputedStyleAttr("paddleLeft","height");return parseInt(t.replace("px",""),10)}(),PaddleControls.prototype.init=function(t){t&&t.paddle&&(this.initParams=t,this.paddle=t.paddle,this.enable())},PaddleControls.prototype.movePaddle=function(){},PaddleControls.prototype.enable=function(){},PaddleControls.prototype.disable=function(){},PaddleControls.prototype.reset=function(){this.disable()},PlayerPaddleControls.prototype=Object.create(PaddleControls.prototype),PlayerPaddleControls.prototype.constructor=PlayerPaddleControls,PlayerPaddleControls.prototype.movePaddle=function(t){var e=t.clientY,o=t.clientX/window.innerWidth*6.283185307179586;PubSub.publish("updatePaddle",{name:this.paddle.name,y:e,rotRad:o})},PaddleControls.prototype.enable=function(){window.addEventListener("mousemove",this.movePaddle.bind(this))},PaddleControls.prototype.disable=function(){window.removeEventListener("mousemove",this.movePaddle.bind(this))},Referee.prototype.init=function(t){t||(t={}),this.initParams=t,this.pubSubTokens=[],this.pubSubTokens.push(["blockBallHit",PubSub.subscribe("blockBallHit",this.blockBallHit.bind(this))],["ballPaddleHit",PubSub.subscribe("ballPaddleHit",this.ballPaddleHit.bind(this))],["boundingBoxBallHit",PubSub.subscribe("boundingBoxBallHit",this.boundingBoxBallHit.bind(this))],["noMoreBlocks",PubSub.subscribe("noMoreBlocks",this.gameOver.bind(this))])},Referee.prototype.reset=function(){this.pubSubTokens.forEach(function(t){PubSub.unsubscribe(t[1])})},Referee.prototype.blockBallHit=function(t,e){var o=e.ball,i=e.block;o&&i&&(o.isRight()&!i.isPrize()?(PubSub.publish("updateScore",{scoreRight:{score:1}}),PubSub.publish("updateBlock",{name:i.name,color:"#f1c40f"})):o.isRight()&&i.isPrizeForRight()?(PubSub.publish("updateScore",{scoreRight:{score:20}}),PubSub.publish("updateBlock",{name:i.name,color:"#7459FF"})):o.isRight()&&i.isPrizeForLeft()?(PubSub.publish("updateScore",{scoreLeft:{score:10}}),PubSub.publish("shakeCanvas",{}),PubSub.publish("updateBlock",{name:i.name,color:"#e74c3c"})):o.isLeft()&&!i.isPrize()?(PubSub.publish("updateScore",{scoreLeft:{score:1}}),PubSub.publish("updateBlock",{name:i.name,color:"#f1c40f"})):o.isLeft()&&i.isPrizeForLeft()?(PubSub.publish("updateScore",{scoreLeft:{score:20}}),PubSub.publish("updateBlock",{name:i.name,color:"#7459FF"})):o.isLeft()&&i.isPrizeForRight()&&(PubSub.publish("updateScore",{scoreRight:{score:10}}),PubSub.publish("updateBlock",{name:i.name,color:"#e74c3c"})))},Referee.prototype.ballPaddleHit=function(t,e){var o=e.ball,i=e.paddle;o&&i&&(o.isRight()&&i.isLeft()?PubSub.publish("updateScore",{scoreRight:{score:5}}):o.isLeft()&&i.isRight()&&(PubSub.publish("updateScore",{scoreLeft:{score:5}}),PubSub.publish("shakeCanvas",{})))},Referee.prototype.boundingBoxBallHit=function(t,e){var o=e.ball;o&&(o.isRight()?(PubSub.publish("updateScore",{scoreLeft:{score:1}}),PubSub.publish("shakeCanvas",{})):o.isLeft()&&PubSub.publish("updateScore",{scoreRight:{score:1}}))},Referee.prototype.gameOver=function(t,e){PubSub.publish("gameOver",{})},Scoreboard.prototype.init=function(t){this.initParams=t,this.scoreLeftId=t.scoreLeftId,this.scoreRightId=t.scoreRightId,this.scoreLeftElement=getNodeById(this.scoreLeftId),this.scoreRightElement=getNodeById(this.scoreRightId),this.scoreElements=[this.scoreLeftElement,this.scoreRightElement],this.updateScorePubSubToken=PubSub.subscribe("updateScore",this.updateScore.bind(this)),this.setEachScore(t.initialScore||0)},Scoreboard.prototype.HEIGHT=function(){var t=getcomputedStyleAttr("scoreLeft","height");return parseInt(t.replace("px",""),10)}(),Scoreboard.prototype.reset=function(){this.setEachScore(0),this.scoreElements=void 0,PubSub.unsubscribe(this.updateScorePubSubToken)},Scoreboard.prototype.setEachScore=function(t){fjs.each(function(e){e.innerHTML=t}.bind(this),this.scoreElements)},Scoreboard.prototype.updateScore=function(t,e){e.scoreLeft&&this.updateScoreLeft(e.scoreLeft.score),e.scoreRight&&this.updateScoreRight(e.scoreRight.score)},Scoreboard.prototype.updateScoreLeft=function(t){this.updateScoreSide(t,0)},Scoreboard.prototype.updateScoreRight=function(t){this.updateScoreSide(t,1)},Scoreboard.prototype.updateScoreSide=function(t,e){var o=this.scoreElements[e].innerHTML;e<this.scoreElements.length&&(this.scoreElements[e].innerHTML=parseInt(o,10)+t)};